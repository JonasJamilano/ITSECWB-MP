<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Manage Accounts</title>
  <link rel="stylesheet" href="admin.css" />
</head>
<body>
  <h2>Manage User Accounts</h2>
  <button onclick="loadUsers()">Refresh List</button>
  <div id="userList"></div>

  <script>
    async function loadUsers() {
      const res = await fetch('/admin/manage-accounts');
      const users = await res.json();
      const container = document.getElementById('userList');

      if (!res.ok) {
        container.innerText = 'Failed to load users';
        return;
      }

      container.innerHTML = '';
      users.forEach(user => {
        const div = document.createElement('div');
        div.style.border = '1px solid #ccc';
        div.style.margin = '5px';
        div.style.padding = '10px';

        div.innerHTML = `
          <strong>${user.username}</strong> (${user.email}) â€” Role: ${user.role}<br />
          <button onclick="deleteUser('${user._id}')">Delete</button>
          <button onclick="changeRolePrompt('${user._id}', '${user.role}')">Change Role</button>
        `;
        container.appendChild(div);
      });
    }

    async function deleteUser(userId) {
      if (!confirm('Are you sure you want to delete this user?')) return;

      const res = await fetch(`/admin/manage-accounts/${userId}`, { method: 'DELETE' });
      const data = await res.json();

      alert(data.message);
      if (res.ok) loadUsers();
    }

    function changeRolePrompt(userId, currentRole) {
      const newRole = prompt('Enter new role (admin, manager, customer):', currentRole);
      if (!newRole || newRole === currentRole) return;

      changeRole(userId, newRole);
    }

    async function changeRole(userId, newRole) {
      const res = await fetch(`/admin/manage-accounts/${userId}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ role: newRole })
      });
      const data = await res.json();
      alert(data.message);
      if (res.ok) loadUsers();
    }

    // Load users on page load
    loadUsers();
  </script>
</body>
</html>
